import React, { useState, useRef } from "react";
import HighlightWithinTextarea from "react-highlight-within-textarea";

function App() {
  const [text, setText] = useState("This is a sample text.");
  const textareaRef = useRef(null);
  const selectionRef = useRef(0);

  const handleMouseDown = (event) => {
    if (event.button !== 0) return; // Ensure it's the left mouse button

    // Manually get selectionStart by focusing on the textarea
    if (textareaRef.current) {
      setTimeout(() => {
        selectionRef.current = textareaRef.current.selectionStart;
      }, 0);
    }
  };

  const handleClick = () => {
    if (!textareaRef.current) return;

    const cursorPosition = selectionRef.current;
    const newText = " [INSERTED] ";

    // Insert new text at the cursor position
    const updatedText =
      text.slice(0, cursorPosition) + newText + text.slice(cursorPosition);

    setText(updatedText);
  };

  return (
    <div
      onMouseDown={handleMouseDown} // Capture cursor position
      onClick={handleClick} // Insert text on left mouse click
      style={{ display: "inline-block", cursor: "text" }}
    >
      <HighlightWithinTextarea
        value={text}
        onChange={(value) => setText(value)}
        highlight={/sample/g} // Example: Highlighting "sample"
        ref={textareaRef}
      />
    </div>
  );
}

export default App;
